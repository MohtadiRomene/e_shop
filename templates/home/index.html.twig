{% extends 'base.html.twig' %}

{% block title %}Accueil - Kaira Fashion Store{% endblock %}

{% block body %}
{# Hero Banner Section - Original Template Style #}
<section class="slideshow swiper slide-clip" style="height: 80vh; min-height: 600px;">
  <div class="swiper-wrapper">
    <div class="swiper-slide" style="background-image: url('{{ asset('images/banner-image-1.jpg') }}'); background-size: cover; background-position: center;">
      <div class="image-holder position-absolute top-0 start-0 w-100 h-100" style="background-image: url('{{ asset('images/banner-image-1.jpg') }}'); background-size: cover; background-position: center;"></div>
      <div class="banner-content d-flex align-items-center justify-content-center h-100 text-white position-relative" style="z-index: 2;">
        <div class="container text-center">
          <h2 class="display-2 mb-4 txt-fx slide-up">
            <span class="word"><span class="letter">N</span><span class="letter">e</span><span class="letter">w</span></span>
            <span class="letter">&nbsp;</span>
            <span class="word"><span class="letter">C</span><span class="letter">o</span><span class="letter">l</span><span class="letter">l</span><span class="letter">e</span><span class="letter">c</span><span class="letter">t</span><span class="letter">i</span><span class="letter">o</span><span class="letter">n</span><span class="letter">s</span></span>
          </h2>
          <p class="lead mb-5" style="max-width: 600px; margin: 0 auto;" data-aos="fade-up" data-aos-delay="200">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Saepe voluptas ut dolorum consequuntur, adipisci repellat! Eveniet commodi voluptatem voluptate, eum minima, in suscipit explicabo voluptatibus harum, quibusdam ex repellat eaque!
          </p>
          <a href="{{ path('app_produits') }}" class="btn btn-primary btn-lg rounded-0 text-uppercase px-5 py-3" style="letter-spacing: 1px;" data-aos="fade-up" data-aos-delay="400">Shop Now</a>
        </div>
      </div>
    </div>
    <div class="swiper-slide" style="background-image: url('{{ asset('images/banner-image-2.jpg') }}');">
      <div class="image-holder position-absolute top-0 start-0 w-100 h-100" style="background-image: url('{{ asset('images/banner-image-2.jpg') }}'); background-size: cover; background-position: center;"></div>
      <div class="banner-content d-flex align-items-center justify-content-center h-100 text-white position-relative" style="z-index: 2;">
        <div class="container text-center">
          <h2 class="display-2 mb-4 txt-fx slide-up">Fashion Trends</h2>
          <p class="lead mb-5" style="max-width: 600px; margin: 0 auto;" data-aos="fade-up" data-aos-delay="200">
            Discover the latest fashion trends and elevate your style with our premium collection.
          </p>
          <a href="{{ path('app_produits') }}" class="btn btn-primary btn-lg rounded-0 text-uppercase px-5 py-3" style="letter-spacing: 1px;" data-aos="fade-up" data-aos-delay="400">Explore</a>
        </div>
      </div>
    </div>
    <div class="swiper-slide" style="background-image: url('{{ asset('images/banner-image-3.jpg') }}');">
      <div class="image-holder position-absolute top-0 start-0 w-100 h-100" style="background-image: url('{{ asset('images/banner-image-3.jpg') }}'); background-size: cover; background-position: center;"></div>
      <div class="banner-content d-flex align-items-center justify-content-center h-100 text-white position-relative" style="z-index: 2;">
        <div class="container text-center">
          <h2 class="display-2 mb-4 txt-fx slide-up">Premium Quality</h2>
          <p class="lead mb-5" style="max-width: 600px; margin: 0 auto;" data-aos="fade-up" data-aos-delay="200">
            Experience luxury and comfort with our carefully curated selection of premium fashion items.
          </p>
          <a href="{{ path('app_produits') }}" class="btn btn-primary btn-lg rounded-0 text-uppercase px-5 py-3" style="letter-spacing: 1px;" data-aos="fade-up" data-aos-delay="400">Discover</a>
        </div>
      </div>
    </div>
  </div>
  <div class="swiper-pagination"></div>
  <button class="swiper-button-prev icon-arrow icon-arrow-left" aria-label="Previous slide"></button>
  <button class="swiper-button-next icon-arrow icon-arrow-right" aria-label="Next slide"></button>
</section>

{# Product Collections Section - Original Style #}
<section id="products" class="py-5 my-5">
  <div class="container">
    <div class="text-center mb-5" data-aos="fade-up">
      <h2 class="h1 mb-3">Featured Products</h2>
      <p class="text-muted">Discover our handpicked selection of premium fashion items</p>
    </div>
    <div class="row g-4 mb-5">
      {% if featuredProducts is not empty %}
        {% for produit in featuredProducts %}
          <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
            <div class="product-item position-relative h-100">
              <div class="position-relative mb-4 image-zoom-effect" style="height: 500px; overflow: hidden;">
                <div class="image-holder">
                  {% if produit.image %}
                    <img src="{{ asset('images/' ~ produit.image) }}" alt="{{ produit.nomProduit }}" class="w-100 h-100" style="object-fit: cover;">
                  {% else %}
                    <div class="w-100 h-100 bg-light d-flex align-items-center justify-content-center">
                      <span class="text-muted">Image produit</span>
                    </div>
                  {% endif %}
                </div>
                <button class="btn-wishlist btn btn-sm position-absolute top-0 end-0 m-2" type="button" aria-label="Add to wishlist" style="background: rgba(255,255,255,0.9); border: none; z-index: 2;">
                  <svg width="20" height="20" fill="currentColor"><use href="#heart"></use></svg>
                </button>
                {% if produit.promotions|length > 0 %}
                  {% for promo in produit.promotions %}
                    {% if promo.dateExpiration >= date() %}
                      <span class="position-absolute top-0 start-0 m-2 badge bg-danger" style="z-index: 2;">-{{ promo.reduction }}%</span>
                    {% endif %}
                  {% endfor %}
                {% endif %}
                <div class="position-absolute bottom-0 start-0 end-0 p-3 bg-white" style="transform: translateY(100%); transition: transform 0.3s;">
                  {% if app.user %}
                    {% if produit.isEnStock() %}
                      <form action="{{ path('app_panier_ajouter', {id: produit.id}) }}" method="post" class="add-to-cart-form">
                        <input type="hidden" name="_token" value="{{ csrf_token('ajouter_' ~ produit.id) }}">
                        <input type="hidden" name="quantite" value="1">
                        <button type="submit" class="btn btn-primary w-100 rounded-0 text-uppercase add-to-cart" style="letter-spacing: 1px;">Add to Cart</button>
                      </form>
                    {% else %}
                      <button class="btn btn-secondary w-100 rounded-0 text-uppercase" disabled style="letter-spacing: 1px;">Rupture de stock</button>
                    {% endif %}
                  {% else %}
                    <a href="{{ path('app_login') }}" class="btn btn-primary w-100 rounded-0 text-uppercase" style="letter-spacing: 1px;">Se connecter</a>
                  {% endif %}
                </div>
              </div>
              <h3 class="h4 mb-3">{{ produit.nomProduit|upper }}</h3>
              <p class="text-muted mb-3">
                {% set prixFinal = produit.prixAsFloat %}
                {% if produit.promotions|length > 0 %}
                  {% for promo in produit.promotions %}
                    {% if promo.dateExpiration >= date() %}
                      {% set prixFinal = promo.appliquerPromo(produit.prixAsFloat) %}
                      <span class="text-decoration-line-through text-muted me-2">{{ produit.prixAsFloat|number_format(2, ',', ' ') }} €</span>
                      <strong class="text-danger">{{ prixFinal|number_format(2, ',', ' ') }} €</strong>
                    {% endif %}
                  {% endfor %}
                {% else %}
                  <strong class="text-dark">{{ produit.prixAsFloat|number_format(2, ',', ' ') }} €</strong>
                {% endif %}
              </p>
              <p class="text-muted mb-4 small">
                {% if produit.description %}
                  {{ produit.description|slice(0, 100) }}{% if produit.description|length > 100 %}...{% endif %}
                {% else %}
                  {{ produit.afficherDetails() }}
                {% endif %}
              </p>
              <a href="{{ path('app_produit_show', {id: produit.id}) }}" class="btn btn-outline-dark rounded-0 text-uppercase border-animation" style="letter-spacing: 1px;">DISCOVER NOW</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12 text-center">
          <p class="text-muted">Aucun produit disponible pour le moment.</p>
        </div>
      {% endif %}
    </div>
  </div>
</section>

{# Category Section - Original Style #}
<section class="py-5 bg-light">
  <div class="container">
    <div class="text-center mb-5" data-aos="fade-up">
      <h2 class="h1 mb-3">Shop by Category</h2>
      <p class="text-muted">Browse our collections</p>
    </div>
    <div class="row g-4">
      <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
        <div class="image-zoom-effect position-relative swipe-up" style="cursor: pointer;">
          <div class="image-holder">
            <img src="{{ asset('images/cat-item1.jpg') }}" alt="Category" class="w-100" style="height: 400px; object-fit: cover;">
          </div>
          <div class="position-absolute bottom-0 start-0 end-0 p-4 text-white text-center" style="background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);">
            <h3 class="h4 mb-2">Women's Fashion</h3>
            <a href="{{ path('app_produits_vetements') }}" class="btn btn-outline-light btn-sm rounded-0">Shop Now</a>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="200">
        <div class="image-zoom-effect position-relative swipe-up" style="cursor: pointer;">
          <div class="image-holder">
            <img src="{{ asset('images/cat-item2.jpg') }}" alt="Category" class="w-100" style="height: 400px; object-fit: cover;">
          </div>
          <div class="position-absolute bottom-0 start-0 end-0 p-4 text-white text-center" style="background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);">
            <h3 class="h4 mb-2">Men's Fashion</h3>
            <a href="{{ path('app_produits_vetements') }}" class="btn btn-outline-light btn-sm rounded-0">Shop Now</a>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="300">
        <div class="image-zoom-effect position-relative swipe-up" style="cursor: pointer;">
          <div class="image-holder">
            <img src="{{ asset('images/cat-item3.jpg') }}" alt="Category" class="w-100" style="height: 400px; object-fit: cover;">
          </div>
          <div class="position-absolute bottom-0 start-0 end-0 p-4 text-white text-center" style="background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);">
            <h3 class="h4 mb-2">Accessories</h3>
            <a href="{{ path('app_produits_accessoires') }}" class="btn btn-outline-light btn-sm rounded-0">Shop Now</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{# Newsletter Section - Original Style #}
<section class="py-5 position-relative" style="background: url('{{ asset('images/bg-newsletter.jpg') }}') center/cover no-repeat; min-height: 400px;">
  <div class="background pattern-bg"></div>
  <div class="container position-relative" style="z-index: 1;">
    <div class="row justify-content-center text-center text-white">
      <div class="col-lg-8" data-aos="fade-up">
        <h2 class="h1 mb-4">Subscribe to Our Newsletter</h2>
        <p class="lead mb-5">Get the latest updates on new products and upcoming sales</p>
        <form class="newsletter-form d-flex gap-2 justify-content-center" style="max-width: 500px; margin: 0 auto;">
          <input type="email" class="form-control rounded-0" placeholder="Enter your email" required style="background: rgba(255,255,255,0.9);">
          <button type="submit" class="btn btn-primary rounded-0 text-uppercase px-4" style="letter-spacing: 1px;">Subscribe</button>
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    // Initialize Swiper with original template settings
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof Swiper !== 'undefined') {
        const slideshow = document.querySelector('.slideshow.swiper');
        if (slideshow) {
          new Swiper(slideshow, {
            slidesPerView: 1,
            spaceBetween: 0,
            speed: 1000,
            loop: true,
            autoplay: {
              delay: 5000,
              disableOnInteraction: false,
            },
            navigation: {
              nextEl: '.icon-arrow-right',
              prevEl: '.icon-arrow-left',
            },
            pagination: {
              el: '.swiper-pagination',
              clickable: true,
            },
          });
        }
      }

      // Text effects initialization (like original template)
      const txtFxElements = document.querySelectorAll('.txt-fx');
      txtFxElements.forEach(function(element) {
        let html = '';
        let t = 0;
        const words = element.textContent.split(/\s/);
        
        words.forEach(function(word) {
          html += '<span class="word">';
          for (let o = 0; o < word.length; o++) {
            html += '<span class="letter" style="transition-delay:' + (300 + 10 * t) + 'ms;">' + word[o] + '</span>';
            t++;
          }
          html += '</span>';
          html += '<span class="letter" style="transition-delay:300ms;">&nbsp;</span>';
          t++;
        });
        element.innerHTML = html;
      });

      // Handle Add to Cart forms with AJAX
      const addToCartForms = document.querySelectorAll('.add-to-cart-form');
      addToCartForms.forEach(function(form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const formData = new FormData(form);
          const button = form.querySelector('button[type="submit"]');
          const originalText = button.textContent;
          
          // Disable button and show loading state
          button.disabled = true;
          button.textContent = 'Ajout...';
          
          fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'same-origin'
          })
          .then(response => {
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
              return response.json();
            } else {
              // If not JSON, it's a redirect - follow it
              window.location.href = response.url || form.action;
              return null;
            }
          })
          .then(data => {
            if (data) {
              if (data.success) {
                button.textContent = 'Ajouté !';
                button.classList.remove('btn-primary');
                button.classList.add('btn-success');
                
                // Show success message
                if (data.message) {
                  // You can add a toast notification here
                  console.log(data.message);
                }
                
                // Update cart count if element exists
                const cartCountBadge = document.querySelector('.cart-count + .badge');
                if (cartCountBadge) {
                  const currentCount = parseInt(cartCountBadge.textContent) || 0;
                  cartCountBadge.textContent = currentCount + 1;
                }
                
                setTimeout(() => {
                  button.textContent = originalText;
                  button.classList.remove('btn-success');
                  button.classList.add('btn-primary');
                  button.disabled = false;
                }, 2000);
              } else {
                alert(data.message || 'Une erreur est survenue');
                button.textContent = originalText;
                button.disabled = false;
              }
            }
          })
          .catch(error => {
            console.error('Error:', error);
            // Fallback to normal form submission
            form.submit();
          });
        });
      });
    });
  </script>
{% endblock %}
