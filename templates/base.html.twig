{# templates/base.html.twig #}
<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <title>{% block title %}Kaira - Fashion Store{% endblock %}</title>
  
  <meta name="author" content="TemplatesJungle">
  <meta name="keywords" content="{% block meta_keywords %}ecommerce,fashion,store{% endblock %}">
  <meta name="description" content="{% block meta_description %}Bootstrap 5 Fashion Store{% endblock %}">
  
  {% block stylesheets %}
    {# Normalize CSS #}
    <link rel="stylesheet" href="{{ asset('css/normalize.css') }}">
    
    {# Bootstrap CDN #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    
    {# Swiper CSS - Local #}
    <link rel="stylesheet" href="{{ asset('css/swiper-bundle.min.css') }}">
    
    {# AOS - Animate On Scroll Library #}
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    {# Vendor CSS #}
    <link rel="stylesheet" href="{{ asset('css/vendor.css') }}">
    
    {# Asset Mapper - CSS chargé via app.js #}
    
    {# Custom Interactive Styles #}
    <style>
      /* Wishlist button active state */
      .btn-wishlist.active {
        background-color: #ff6b6b !important;
        color: white !important;
      }
      .btn-wishlist.active svg {
        fill: white;
      }
      
      /* Product hover effect */
      .product-item:hover .position-absolute.bottom-0 {
        transform: translateY(0) !important;
      }
      
      /* Smooth transitions */
      .btn-wishlist, .add-to-cart {
        transition: all 0.3s ease;
      }
      
      /* Search modal styling */
      #searchModal .modal-content {
        background: transparent;
        border: none;
      }
      #searchModal .form-control {
        font-size: 1.5rem;
        padding: 1rem 0;
        background: transparent;
        border: none;
        border-bottom: 2px solid #111;
        border-radius: 0;
      }
      #searchModal .form-control:focus {
        box-shadow: none;
        border-bottom-color: #8C907E;
      }
    </style>
    
    {# Google Fonts #}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Marcellus&display=swap" rel="stylesheet">
  {% endblock %}
</head>

<body class="{% block body_class %}homepage{% endblock %}" style="padding-top: 80px;">
  
  {# SVG Icons Sprite - IMPORTANT pour les icônes #}
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <defs>
      <symbol xmlns="http://www.w3.org/2000/svg" id="instagram" viewBox="0 0 15 15">
        <path fill="none" stroke="currentColor"
          d="M11 3.5h1M4.5.5h6a4 4 0 0 1 4 4v6a4 4 0 0 1-4 4h-6a4 4 0 0 1-4-4v-6a4 4 0 0 1 4-4Zm3 10a3 3 0 1 1 0-6a3 3 0 0 1 0 6Z" />
      </symbol>
      <symbol xmlns="http://www.w3.org/2000/svg" id="facebook" viewBox="0 0 15 15">
        <path fill="none" stroke="currentColor"
          d="M7.5 14.5a7 7 0 1 1 0-14a7 7 0 0 1 0 14Zm0 0v-8a2 2 0 0 1 2-2h.5m-5 4h5" />
      </symbol>
      <symbol xmlns="http://www.w3.org/2000/svg" id="twitter" viewBox="0 0 15 15">
        <path fill="currentColor"
          d="m14.478 1.5l.5-.033a.5.5 0 0 0-.871-.301l.371.334Zm-.498 2.959a.5.5 0 1 0-1 0h1Zm-6.49.082h-.5h.5Zm0 .959h.5h-.5Zm-6.99 7V12a.5.5 0 0 0-.278.916L.5 12.5Zm.998-11l.469-.175a.5.5 0 0 0-.916-.048l.447.223Zm3.994 9l.354.353a.5.5 0 0 0-.195-.827l-.159.474Zm7.224-8.027l-.37.336l.18.199l.265-.04l-.075-.495Zm1.264-.94c.051.778.003 1.25-.123 1.606c-.122.345-.336.629-.723 1l.692.722c.438-.42.776-.832.974-1.388c.193-.546.232-1.178.177-2.006l-.998.066Zm0 3.654V4.46h-1v.728h1Zm-6.99-.646V5.5h1v-.959h-1Zm0 .959V6h1v-.5h-1ZM10.525 1a3.539 3.539 0 0 0-3.537 3.541h1A2.539 2.539 0 0 1 10.526 2V1Zm2.454 4.187C12.98 9.503 9.487 13 5.18 13v1c4.86 0 8.8-3.946 8.8-8.813h-1ZM1.03 1.675C1.574 3.127 3.614 6 7.49 6V5C4.174 5 2.421 2.54 1.966 1.325l-.937.35Zm.021-.398C.004 3.373-.157 5.407.604 7.139c.759 1.727 2.392 3.055 4.73 3.835l.317-.948c-2.155-.72-3.518-1.892-4.132-3.29c-.612-1.393-.523-3.11.427-5.013l-.895-.446Zm4.087 8.87C4.536 10.75 2.726 12 .5 12v1c2.566 0 4.617-1.416 5.346-2.147l-.708-.706Zm7.949-8.009A3.445 3.445 0 0 0 10.526 1v1c.721 0 1.37.311 1.82.809l.74-.671Zm-.296.83a3.513 3.513 0 0 0 2.06-1.134l-.744-.668a2.514 2.514 0 0 1-1.466.813l.15.989ZM.222 12.916C1.863 14.01 3.583 14 5.18 14v-1c-1.63 0-3.048-.011-4.402-.916l-.556.832Z" />
      </symbol>
      <symbol xmlns="http://www.w3.org/2000/svg" id="pinterest" viewBox="0 0 15 15">
        <path fill="none" stroke="currentColor"
          d="m4.5 13.5l3-7m-3.236 3a2.989 2.989 0 0 1-.764-2V7A3.5 3.5 0 0 1 7 3.5h1A3.5 3.5 0 0 1 11.5 7v.5a3 3 0 0 1-3 3a2.081 2.081 0 0 1-1.974-1.423L6.5 9m1 5.5a7 7 0 1 1 0-14a7 7 0 0 1 0 14Z" />
      </symbol>
      <symbol xmlns="http://www.w3.org/2000/svg" id="youtube" viewBox="0 0 15 15">
        <path fill="currentColor"
          d="m1.61 12.738l-.104.489l.105-.489Zm11.78 0l.104.489l-.105-.489Zm0-10.476l.104-.489l-.105.489Zm-11.78 0l.106.489l-.105-.489ZM6.5 5.5l.277-.416A.5.5 0 0 0 6 5.5h.5Zm0 4H6a.5.5 0 0 0 .777.416L6.5 9.5Zm3-2l.277.416a.5.5 0 0 0 0-.832L9.5 7.5ZM0 3.636v7.728h1V3.636H0Zm15 7.728V3.636h-1v7.728h1ZM1.506 13.227c3.951.847 8.037.847 11.988 0l-.21-.978a27.605 27.605 0 0 1-11.568 0l-.21.978ZM13.494 1.773a28.606 28.606 0 0 0-11.988 0l.21.978a27.607 27.607 0 0 1 11.568 0l.21-.978ZM15 3.636c0-.898-.628-1.675-1.506-1.863l-.21.978c.418.09.716.458.716.885h1Zm-1 7.728a.905.905 0 0 1-.716.885l.21.978A1.905 1.905 0 0 0 15 11.364h-1Zm-14 0c0 .898.628 1.675 1.506 1.863l.21-.978A.905.905 0 0 1 1 11.364H0Zm1-7.728c0-.427.298-.796.716-.885l-.21-.978A1.905 1.905 0 0 0 0 3.636h1ZM6 5.5v4h1v-4H6Zm.777 4.416l3-2l-.554-.832l-3 2l.554.832Zm3-2.832l-3-2l-.554.832l3 2l.554-.832Z" />
      </symbol>
      <symbol xmlns="http://www.w3.org/2000/svg" id="heart" viewBox="0 0 24 24">
        <path fill="currentColor"
          d="M20.16 4.61A6.27 6.27 0 0 0 12 4a6.27 6.27 0 0 0-8.16 9.48l7.45 7.45a1 1 0 0 0 1.42 0l7.45-7.45a6.27 6.27 0 0 0 0-8.87Zm-1.41 7.46L12 18.81l-6.75-6.74a4.28 4.28 0 0 1 3-7.3a4.25 4.25 0 0 1 3 1.25a1 1 0 0 0 1.42 0a4.27 4.27 0 0 1 6 6.05Z" />
      </symbol>
      <symbol xmlns="http://www.w3.org/2000/svg" id="cart" viewBox="0 0 24 24">
        <path fill="currentColor"
          d="M8.5 19a1.5 1.5 0 1 0 1.5 1.5A1.5 1.5 0 0 0 8.5 19ZM19 16H7a1 1 0 0 1 0-2h8.491a3.013 3.013 0 0 0 2.885-2.176l1.585-5.55A1 1 0 0 0 19 5H6.74a3.007 3.007 0 0 0-2.82-2H3a1 1 0 0 0 0 2h.921a1.005 1.005 0 0 1 .962.725l.155.545v.005l1.641 5.742A3.013 3.013 0 0 0 8.491 14H19a1 1 0 0 1 0 2Z" />
      </symbol>
    </defs>
  </svg>

  {# Messages flash #}
  {% for message in app.flashes('success') %}
    <div class="alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-5" style="z-index: 9999; min-width: 300px;" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}

  {% for message in app.flashes('error') %}
    <div class="alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-5" style="z-index: 9999; min-width: 300px;" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}

  {% block header %}
    {% include 'includes/header.html.twig' %}
  {% endblock %}

  <main>
    {% block body %}{% endblock %}
  </main>

  {% block footer %}
    {% include 'includes/footer.html.twig' %}
  {% endblock %}

  {# Search Popup Modal #}
  <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 rounded-0">
        <div class="modal-header border-0 pb-0">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
            <div class="modal-body">
              <form class="search-popup-form" id="searchForm" action="{{ path('app_search') }}" method="get">
                <input type="search" name="q" class="form-control border-0 border-bottom rounded-0" id="searchInput" placeholder="Rechercher des produits..." autofocus>
                <button type="submit" class="btn btn-primary mt-3 rounded-0">Rechercher</button>
              </form>
            </div>
      </div>
    </div>
  </div>

  {% block javascripts %}
    {# Modernizr #}
    <script src="{{ asset('js/modernizr.js') }}"></script>
    
    {# jQuery #}
    <script src="{{ asset('js/jquery.min.js') }}"></script>
    
    {# Bootstrap JS Bundle #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"></script>
    
    {# Swiper JS - CDN #}
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
    
    {# AOS - Animate On Scroll Library #}
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    {# Plugins JS #}
    <script src="{{ asset('js/plugins.js') }}"></script>
    
    {# SmoothScroll #}
    <script src="{{ asset('js/SmoothScroll.js') }}"></script>
    
    {# Main Script #}
    <script src="{{ asset('js/script.min.js') }}"></script>
    
    {# Custom Interactive Scripts #}
    <script src="{{ asset('js/kaira-interactive.js') }}"></script>
    
    {# Initialize AOS #}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        AOS.init({
          duration: 1200,
          once: true,
          offset: 100,
          easing: 'ease-out-cubic'
        });
      });
    </script>
    
    {# Fix Bootstrap Dropdowns with Turbo #}
    <script>
      (function() {
        function initDropdowns() {
          // Réinitialiser tous les dropdowns Bootstrap
          const dropdownToggles = document.querySelectorAll('[data-bs-toggle="dropdown"]');
          dropdownToggles.forEach(toggle => {
            if (typeof bootstrap !== 'undefined' && bootstrap.Dropdown) {
              try {
                // Détruire l'instance existante si elle existe
                const existingInstance = bootstrap.Dropdown.getInstance(toggle);
                if (existingInstance) {
                  existingInstance.dispose();
                }
                
                // Créer une nouvelle instance
                new bootstrap.Dropdown(toggle, {
                  boundary: 'viewport',
                  popperConfig: {
                    placement: 'bottom-end'
                  }
                });
              } catch (e) {
                console.warn('Erreur lors de l\'initialisation du dropdown:', e);
              }
            }
          });
        }

        // Initialiser au chargement initial
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initDropdowns);
        } else {
          initDropdowns();
        }

        // Réinitialiser après chaque navigation Turbo
        if (typeof Turbo !== 'undefined') {
          document.addEventListener('turbo:load', initDropdowns);
          document.addEventListener('turbo:render', initDropdowns);
          document.addEventListener('turbo:frame-load', initDropdowns);
        }

        // Fallback : réinitialiser après un court délai (pour les cas où Turbo n'est pas détecté)
        setTimeout(initDropdowns, 100);
      })();
    </script>
    
    {# Asset Mapper - JavaScript #}
    {{ importmap('app') }}
  {% endblock %}
</body>
</html>
